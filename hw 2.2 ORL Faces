import keras
import matplotlib.pyplot as plt
import numpy as np
from keras.layers import Dense
from keras.models import Sequential

# load data
data = np.load('ORL_faces.npz')
trainX = data['trainX']
trainY = data['trainY']
testX = data['testX']
testY = data['testY']

trainX = trainX / 255.
trainY = trainY.astype(int)
testX = testX / 255.
testY = testY.astype(int)


trainY = keras.utils.to_categorical(trainY, num_classes=20)
testY = keras.utils.to_categorical(testY, num_classes=20)

model = Sequential()
print(trainX.shape)
print(trainY.shape)
model.add(Dense(units=240, activation='sigmoid', input_shape=(10304,)))
model.add(Dense(units=20, activation='softmax'))

model.compile(optimizer='sgd', loss='categorical_crossentropy', metrics=['accuracy'])
history = model.fit(trainX, trainY, batch_size=128, epochs=100, verbose=False, validation_split=.1)

loss, accuracy = model.evaluate(testX, testY, verbose=False)
print(f'Classification accuracy: {accuracy:.3}')


plt.plot(history.history['loss'])
plt.title('model loss')
plt.ylabel('loss')
plt.xlabel('iterations/epochs')
plt.show()

